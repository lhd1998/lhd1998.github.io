(function(t){function a(a){for(var n,o,r=a[0],l=a[1],c=a[2],u=0,h=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&h.push(i[o][0]),i[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);d&&d(a);while(h.length)h.shift()();return s.push.apply(s,c||[]),e()}function e(){for(var t,a=0;a<s.length;a++){for(var e=s[a],n=!0,r=1;r<e.length;r++){var l=e[r];0!==i[l]&&(n=!1)}n&&(s.splice(a--,1),t=o(o.s=e[0]))}return t}var n={},i={app:0},s=[];function o(a){if(n[a])return n[a].exports;var e=n[a]={i:a,l:!1,exports:{}};return t[a].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=t,o.c=n,o.d=function(t,a,e){o.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,a){if(1&a&&(t=o(t)),8&a)return t;if(4&a&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var n in t)o.d(e,n,function(a){return t[a]}.bind(null,n));return e},o.n=function(t){var a=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(a,"a",a),a},o.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=a,r=r.slice();for(var c=0;c<r.length;c++)a(r[c]);var d=l;s.push([0,"chunk-vendors"]),e()})({0:function(t,a,e){t.exports=e("56d7")},"0168":function(t,a,e){"use strict";var n=e("793c"),i=e.n(n);i.a},1:function(t,a){},1642:function(t,a,e){},"1e2a":function(t,a,e){t.exports=e.p+"img/mask-2.9a238155.png"},2:function(t,a){},"25cd":function(t,a,e){t.exports=e.p+"img/mask-7.5ffb38cd.png"},3:function(t,a){},"40a6":function(t,a,e){"use strict";var n=e("cefd"),i=e.n(n);i.a},"48b4":function(t,a,e){t.exports=e.p+"img/clothes.5cbfbe5a.png"},"4bdb":function(t,a,e){t.exports=e.p+"img/mask-3.df55eb14.png"},"56d7":function(t,a,e){"use strict";e.r(a);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("2b0e"),i=e("140a"),s=e.n(i),o=e("e526"),r=e.n(o),l=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"app"}},[t.isShowToast?e("Toast",[t._v(t._s(t.toastMessage))]):t._e(),e("ImgShow"),e("ImgConsole")],1)},c=[],d=(e("96cf"),e("1da1")),u=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{ref:"bgImg",staticClass:"container",style:t.bgImg.style,on:{click:function(a){t.notEditable--}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowBgImg,expression:"!isShowBgImg"}],staticClass:"upload-wrap",on:{click:t.handleUploadClick}},[e("div",{staticClass:"btn-upload"}),e("p",[t._v("点击上传你的头像")]),e("input",{ref:"inputUpload",staticStyle:{display:"none"},attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:t.handleImgUploadChange}})]),e("MaskEdit",{attrs:{"not-editable":t.notEditable,"is-show-bg-img":t.isShowBgImg}}),e("img",{directives:[{name:"show",rawName:"v-show",value:t.isShowNewAvatar,expression:"isShowNewAvatar"}],staticClass:"new-avatar",attrs:{src:t.newAvatar.imgUrl,alt:"新头像",width:t.newAvatar.width,height:t.newAvatar.height}})],1)},h=[],g=(e("4160"),e("159b"),e("ac19")),f=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.listOfMask.length>0,expression:"listOfMask.length > 0"}]},t._l(t.listOfMask,(function(a,n){return e("div",{directives:[{name:"finger",rawName:"v-finger:rotate",value:t.editMaskIdx==n?t.handleRotateImg.bind(this,n):null,expression:"\n      editMaskIdx == idx ? handleRotateImg.bind(this, idx) : null\n    ",arg:"rotate"}],key:n,class:t.getMaskWrapClass(n),style:{transform:"translateX("+a.x+"px) translateY("+a.y+"px) rotate("+a.r+"deg) scale("+a.s+")"},on:{touchstart:t.handleMaskTouchStart,touchmove:function(a){a.stopPropagation(),a.preventDefault(),t.editMaskIdx==n&&t.handleMaskTouchMove(n,a)},click:function(a){a.stopPropagation(),t.editMaskIdx=n}}},[e("img",{staticClass:"mask-img",attrs:{src:a.imgUrl,alt:"口罩图片",width:a.width,height:a.height,crossorigin:"anonymous"}}),t.editMaskIdx==n?e("div",{staticClass:"btn-close",on:{click:function(a){return t.handleCloseBtnClick(n)}}}):t._e()])})),0)},m=[],p=(e("a434"),{name:"MaskEdit",props:["notEditable","isShowBgImg"],data:function(){return{listOfMask:[],editMaskIdx:0,oldPos:[{x:0,y:0},{x:0,y:0}],oldDistance:0}},watch:{notEditable:function(){this.$data.editMaskIdx=-1}},created:function(){var t=this;this.$bus.$on("add-mask",(function(a){t.isShowBgImg?(t.$data.listOfMask.push({imgUrl:a,width:135,height:135,x:130,y:50,r:0,s:1}),t.$data.editMaskIdx=t.$data.listOfMask.length-1):t.$bus.$emit("show-toast","请先上传图片!")}))},methods:{getMaskWrapClass:function(t){return this.$data.editMaskIdx!=t?["mask-img-wrap"]:["mask-img-wrap","edit-enable"]},updateOldPos:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.$data.oldPos[0].x=t,this.$data.oldPos[0].y=a,this.$data.oldPos[1].x=e,this.$data.oldPos[1].y=n},getDistance:function(t,a,e,n){return Math.pow(t-e,2)+Math.pow(a-n,2)},handleMaskTouchStart:function(t){if(1==t.touches.length){var a=t.touches[0];this.updateOldPos(a.clientX,a.clientY)}else{var e=[t.touches[0],t.touches[1]],n=e[0],i=e[1];this.$data.oldDistance=this.getDistance(n.clientX,n.clientY,i.clientX,i.clientY),this.updateOldPos(n.clientX,n.clientY,i.clientX,i.clientY)}},handleMaskTouchMove:function(t,a){1==a.touches.length?this.moveImage(t,a.touches[0]):this.scaleImage(t,a.touches[0],a.touches[1])},moveImage:function(t,a){var e=a.clientX-this.$data.oldPos[0].x,n=a.clientY-this.$data.oldPos[0].y,i=this.$data.listOfMask[t];i.x+=e,i.y+=n,this.updateOldPos(a.clientX,a.clientY)},scaleImage:function(t,a,e){var n=this.$data.listOfMask[t],i=this.$data.oldDistance,s=this.getDistance(a.clientX,a.clientY,e.clientX,e.clientY),o=Math.sqrt(s)-Math.sqrt(i);n.s+=o/10*.1,this.$data.oldDistance=s},handleRotateImg:function(t,a){a.preventDefault();var e=this.$data.listOfMask[t];e.r+=a.angle},handleCloseBtnClick:function(t){this.$data.listOfMask.splice(t,1)}}}),v=p,b=(e("b389"),e("2877")),w=Object(b["a"])(v,f,m,!1,null,"123e55ed",null),$=w.exports,k={name:"ImgShow",data:function(){return{isShowBgImg:!1,bgImg:{width:390,height:390,imgUrl:null,style:null},notEditable:0,isShowNewAvatar:!1,newAvatar:{imgUrl:null,width:390,height:390}}},components:{MaskEdit:$},created:function(){var t=this;this.$bus.$on("reupload",(function(){t.$data.isShowNewAvatar=!1,t.$data.isShowBgImg=!1,t.$children[0].$data.listOfMask=[],t.handleUploadClick()})),this.$bus.$on("draw-avatar",(function(){if(t.$data.isShowBgImg){var a=t.$children[0].listOfMask,e=new g["a"]({width:t.$data.bgImg.width,height:t.$data.bgImg.height}),n=e.background(t.$data.bgImg.imgUrl,{left:0,top:0,type:"contain"});a.forEach((function(t){n=n.add(t.imgUrl,{width:t.width,height:t.height,pos:{x:t.x,y:t.y,scale:t.s,rotate:t.r}})})),n.draw({type:"png",quality:1,success:function(a){t.$data.newAvatar.imgUrl=a,t.$data.newAvatar.width=t.$data.bgImg.width,t.$data.newAvatar.height=t.$data.bgImg.height,t.$data.isShowNewAvatar=!0,t.$data.bgImg.style={height:t.$data.bgImg.height},t.$bus.$emit("draw-success")}})}else t.$bus.$emit("show-toast","请先上传图片!")}))},methods:{handleImgUploadChange:function(t){var a=this,e=t.target.files[0],n=new FileReader;if(this.$data.isShowNewAvatar&&(this.$data.isShowNewAvatar=!1),!/image.*/.test(e.type))return!1;n.readAsDataURL(e),n.onload=function(t){var e=new Image;e.src=t.target.result,e.onload=function(){var n=e.height*(a.$refs.bgImg.offsetWidth/e.width);a.$data.bgImg.height=n,a.$data.bgImg.width=a.$refs.bgImg.offsetWidth,a.$data.bgImg.imgUrl=t.target.result,a.$data.bgImg.style={backgroundImage:"url(".concat(t.target.result,")"),backgroundPosition:"center",backgroundSize:"contain",backgroundRepeat:"no-repeat",height:"".concat(n,"px")},a.$data.isShowBgImg=!0}}},handleUploadClick:function(){this.$refs["inputUpload"].click()}}},x=k,I=(e("0168"),Object(b["a"])(x,u,h,!1,null,"4cb86067",null)),y=I.exports,M=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[e("ul",{staticClass:"things-list"},t._l(t.listOfThings,(function(a,n){return e("li",{key:a.name,staticClass:"things-item",style:{backgroundImage:"url("+a.imgUrl+")"},on:{click:function(a){return t.handleSelectClick(n)}}})})),0),e("div",{staticClass:"btn-wrap"},[e("div",{staticClass:"btn reupload",attrs:{role:"button"},on:{click:t.handleReuploadClick}},[t._v(" 重新上传 ")]),e("div",{staticClass:"btn draw-avatar-btn",attrs:{role:"button"},on:{click:t.handleNewAvatarClick}},[t._v(" 生成新头像 ")])])])},O=[],S=e("8b16"),C=e.n(S),U=e("1e2a"),_=e.n(U),P=e("4bdb"),A=e.n(P),T=e("75d4"),j=e.n(T),E=e("f020"),N=e.n(E),R=e("967c"),B=e.n(R),D=e("25cd"),X=e.n(D),Y=e("6521"),W=e.n(Y),q=e("9d73"),F=e.n(q),J=e("48b4"),z=e.n(J),L={name:"ImgConsole",data:function(){return{listOfThings:[{name:"mask-1",imgUrl:C.a},{name:"mask-7",imgUrl:X.a},{name:"glasses-1",imgUrl:W.a},{name:"glasses-2",imgUrl:F.a},{name:"mask-5",imgUrl:N.a},{name:"mask-6",imgUrl:B.a},{name:"mask-2",imgUrl:_.a},{name:"mask-3",imgUrl:A.a},{name:"mask-4",imgUrl:j.a},{name:"clothes",imgUrl:z.a}]}},created:function(){var t=this;this.$bus.$on("draw-success",(function(){t.$bus.$emit("show-toast","合成成功,长按图片即可保存")}))},methods:{handleReuploadClick:function(){this.$bus.$emit("reupload")},handleSelectClick:function(t){this.$bus.$emit("add-mask",this.$data.listOfThings[t].imgUrl)},handleNewAvatarClick:function(){this.$bus.$emit("draw-avatar")}}},G=L,H=(e("f44e"),Object(b["a"])(G,M,O,!1,null,"6c34687d",null)),K=H.exports,Q=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"toast-box"},[t._t("default")],2)},V=[],Z={},tt=Z,at=(e("40a6"),Object(b["a"])(tt,Q,V,!1,null,"26568e78",null)),et=at.exports,nt=e("ab39"),it={name:"App",data:function(){return{isShowToast:!1,toastMessage:""}},components:{ImgConsole:K,ImgShow:y,Toast:et},created:function(){var t=this;this.$bus.$on("show-toast",(function(a){t.$data.toastMessage=a,t.$data.isShowToast=!0;var e=setTimeout((function(){t.$data.isShowToast=!1,clearTimeout(e)}),1500)}))},methods:{init:function(){return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,nt["a"].ssdMobilenetv1.load("@/assets/weights");case 2:case"end":return t.stop()}}),t)})))()},handleReupload:function(){this.$data.isReupload++}}},st=it,ot=(e("5c0b"),Object(b["a"])(st,l,c,!1,null,null,null)),rt=ot.exports;n["a"].config.productionTip=!1,n["a"].prototype.$bus=new n["a"]({}),n["a"].use(r.a,{AlloyFinger:s.a}),new n["a"]({render:function(t){return t(rt)}}).$mount("#app")},"5c0b":function(t,a,e){"use strict";var n=e("9c0c"),i=e.n(n);i.a},6521:function(t,a,e){t.exports=e.p+"img/glasses-1.781aec06.png"},"75d4":function(t,a,e){t.exports=e.p+"img/mask-4.ac1d23a1.png"},"793c":function(t,a,e){},"8b16":function(t,a,e){t.exports=e.p+"img/mask-1.1248680a.png"},"967c":function(t,a,e){t.exports=e.p+"img/mask-6.29e9ce3d.png"},"9c0c":function(t,a,e){},"9d73":function(t,a,e){t.exports=e.p+"img/glasses-2.d9e19b85.png"},b389:function(t,a,e){"use strict";var n=e("1642"),i=e.n(n);i.a},cefd:function(t,a,e){},f020:function(t,a,e){t.exports=e.p+"img/mask-5.1f0c2536.png"},f44e:function(t,a,e){"use strict";var n=e("f84b"),i=e.n(n);i.a},f84b:function(t,a,e){}});
//# sourceMappingURL=app.43d784a3.js.map